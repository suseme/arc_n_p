# 3. 第3章 理解质量属性

> 质量从来都不是偶然的；它一直是高度的意图、真诚的努力、明智的方向和熟练的执行力的结果。
>
> —William A. Foster 威廉·福斯特

许多因素决定了系统架构中必须提供的质量（qualities）。这些质量比功能更重要，功能是系统能力、服务和行为的基本陈述。尽管功能和其他质量密切相关，但正如你将看到的，功能通常在开发计划中占据主要地位。然而，这种偏好是短视的。系统经常被重新设计，不是因为它们在功能上存在缺陷（替换成的通常在功能上是相同的），而是因为它们难以维护、移植或扩展；或者它们运行太慢了；或者它们已被黑客入侵。在 [第2章][ch02] 中，我们说架构是软件创建过程中可以解决质量需求的首个地方。系统功能到软件结构的映射决定了架构对质量的支持。在 [第4章][ch04] 到 [第14章][ch14] 中，我们讨论了架构设计决策如何支持各种质量。在 [第 20 章][ch20] 中，我们展示了如何将所有驱动因素（包括质量属性决策）集成到一个连贯的设计中。

我们一直松散地使用“质量属性”这一术语，但现在是时候更仔细地定义它了。质量属性（QA）是可度量或可测试的系统属性，用于指示系统（在除了系统基本功能之外）满足利益相关者需求的程度。你可以将质量属性视为：在沿着利益相关者感兴趣的某个维度上衡量产品的“效用”。

在本章中，我们的重点是介绍以下内容：

- 如何表达我们的架构所希望展示的品质

- 如何通过架构工具实现品质

- 如何确定与质量有关的设计决策

本章为讨论 [第4章][ch04] 到 [第14章][ch14] 中各个质量属性的提供了背景。

## 3.1. 功能性

功能性是系统完成预期工作的能力。在所有需求中，功能性与架构的关系最奇怪。

首先，功能性并不决定架构。也就是说，给定一组必需的功能，你可以创建无尽的的架构来满足该功能。至少，你可以通过多种方式划分功能，并将子功能分配给不同的架构元素。

事实上，如果功能是唯一重要的事情，你根本不需要将系统划分为多个部分：一个没有内部结构的单一块就可以了。相反，我们将系统设计为协作的架构元素（模块、层、类、服务、数据库、应用程序、线程、对等节点、层等）的结构化集合，以使它们易于理解并支持各种其他用途。这些“其他用途”是我们将在本章其余部分研究的其他质量属性，以及 [第二部分][part02] 中一系列质量属性相关的章节中也会讨论。

虽然功能性独立于任何特定结构，但它是通过为架构元素分配职责来实现的。这个过程产生了最基本的一个架构结构——模块分解。

尽管职责可以任意分配给某个模块，但当其他质量属性很重要时，软件架构会限制这种分配。例如，系统经常（或可能总是）被分割，以便几个人可以合作地构建它们。架构师对功能性的兴趣在于它如何与其他质量交互并约束其他质量。

> **功能需求**
>
> 经过30多年的写作和讨论功能需求和质量要求之间的区别之后，功能需求的定义仍然让我难以理解。质量属性需求定义明确：性能与系统的时间相关的行为有关，可修改性与系统在初始部署后支持对其行为或其他质量更改的能力有关，可用性与系统在故障中幸存的能力有关，等等。
>
> 然而，功能是一个更模糊的概念。国际标准（ISO 25010）将功能适用性定义为“软件产品在特定条件下使用时，能够提供满足规定和隐含需求的功能的能力”。也就是说，功能性是提供功能的能力。对这个定义的一种解释是，功能性描述了系统做了什么，质量描述了系统实现它功能实现的怎么样。也就是说，质量是系统的属性，功能是系统的目的。
>
> 然而，当你考虑某些“功能”的性质时，这种区别就被打破了。如果软件的功能是控制发动机行为，如何在不考虑时间相关的行为的情况下正确实现该功能？通过要求用户名/密码组合来控制访问的能力是不是一种功能，即使它不是任何系统的目的？
>
> 我更喜欢用“职责”这个词来描述系统必须执行的计算。诸如“这组职责的时间限制是什么？”，“预计对这组职责进行哪些修改？”以及“允许哪类用户执行这组职责？”等问题是有意义的，并且是可操作的。
>
> 质量的成就产生职责；想想刚才提到的用户名/密码示例。此外，人们可以将职责与一组特定的需求相关联。
>
> 那么这是否意味着不应该使用术语“功能需求”？人们对这个术语有自己的理解，但是当需要精确性时，我们应该谈论一系列具体的职责。
>
> 保罗·克莱门茨（Paul Clements）长期以来一直反对漫不经心地使用“非功能性”一词，现在轮到我猛烈反对漫不经心地使用“功能性”一词了——这两个可能都是无益的。
>
> —LB

## 3.2. 质量属性考量

正如系统的功能不会在没有适当考虑质量属性的情况下独立存在一样，质量属性也不会独立存在；它们与系统的功能有关。如果功能需求是“当用户按下绿色按钮时，将显示”选项“对话框”，则性能 QA 注解可能会描述对话框的显示速度；可用性 QA 注解可能会描述此功能允许失败的频率以及修复速度；易用性 QA 注解可能会描述学习此功能的难易程度。

至少自 1970 年代以来，软件社区就已经将质量属性作为独特的主题来研究了。并且已经发表了各种分类法和定义（我们在 [第14章][ch14] 中讨论了其中一些），其中许多都有自己的研究和从业者社区。但是，大多数关于系统质量属性的讨论都存在三个问题：

1. 为属性提供的定义不可测试。说一个系统是“可修改的”是没有意义的。每个系统对于一组变更都是可修改的，并且对于另一组变更则是不可修改的。在这方面，其他质量属性也是类似的：系统在某些缺陷方面可能是健壮的，而对于其他的缺陷可能是脆弱的，等等。

2. 讨论通常集中在某个特定问题属于哪种质量上。对系统的拒绝服务攻击是可用性层面的、性能层面的、安全性层面还是易用性层面的？所有四个属性社区都将声称对拒绝服务攻击具有“所有权”。在某种程度上，所有这些都是正确的。但是，这种关于分类的争论并不能帮助作为架构师的我们，去理解和创建架构性解决方案来实际管理关注的属性。

3. 每个属性社区都开发了自己的词汇表。性能社区有“事件”到达系统，安全社区有“攻击”到达系统，可用性社区有“错误”到达，易用性社区有“用户输入”。所有这些实际上可能指的是相同的事件，但它们使用不同的术语来描述。

前两个问题（定义无法测试和重叠问题）的解决方案是使用 *质量属性场景（quality attribute scenarios）* 作为表征质量属性的方法（参见 [第3.3节][ch03_sec03]）。第三个问题的解决方案是以共同的形式来说明该属性群体的基本概念，我们在 [第4章][ch04] 到 [第14章][ch14] 中就是这样做的。

我们将重点介绍两类质量属性。第一类包括描述运行时系统的某些属性（如可用性、性能或易用性）的属性。第二类包括描述系统开发时的某些属性，例如可修改性、可测试性或可部署性。

质量属性永远无法独立地实现。实现任意一个都会对其它的实现产生影响——有时是积极的，有时是消极的。例如，几乎每个质量属性都会对性能产生负面影响。以可移植性为例：实现可移植软件的主要技术是隔离系统依赖关系，这会给系统的执行带来开销，通常是进程或程序边界，这会损害性能。确定可能满足质量属性需求的设计，在一定程度上是进行适当权衡的问题；我们在 [第21章][ch21] 中讨论设计。

在接下来的三节中，我们将重点介绍如何指定质量属性，哪些架构决策将有助于实现特定的质量属性，以及有关质量属性哪些的问题将促使架构师能够做出正确的设计决策。

## 3.3. 指定质量属性需求：质量属性场景

我们使用一种共通的形式将所有 QA 要求指定为场景。这解决了我们之前发现的词汇问题。这种共通的形式是可测试且明确的；它对异想天开的分类不敏感。因此，它为我们如何处理所有质量属性提供了一致性。

质量属性场景有六个部分：

- *触发事件（stimulus）*：我们使用术语“触发事件”来描述到达系统或项目的事件。触发事件可能是：对性能社区来说的*事件*，对易用性社区来说的*用户操作*，或者对安全社区来说的*攻击*，等等。我们使用相同的术语来描述待开发质量的激励行为。因此，对可修改性的触发事件是对修改的请求；可测试性的触发事件是开发单元的完成。

- *触发源（*Stimulus source*）*：触发事件必须有一个来源——它必须来自某个地方。某个实体（人类、计算机系统或任何其他参与者）必须产生触发事件。触发事件的来源可能会影响系统如何处理它。来自受信任用户的请求不会受到与不受信任用户的请求相同的审查。

- *响应（*Response*）*：响应是由于触发事件的到来而发生的活动。响应是架构师承诺满足的。它由系统（运行时质量）或开发人员（开发时质量）响应触发事件时应执行的职责组成。例如，在性能方案中，事件到达（触发事件），系统应处理该事件并生成响应。在可修改性方案中，修改请求到达（触发事件），开发人员应实现修改（没有副作用），然后测试和部署修改。

- *响应测量（Response measure）*：当响应发生时，它应该以某种方式可测量，以便场景可以测试，也就是说，这样我们就可以确定架构师是否实现了它。对于性能，这可能是对延迟或吞吐量的测量；对于可修改性，可能是进行、测试和部署修改所需的人工或时间。

场景的这四个特征是我们质量属性规范的核心。还有两个特征很重要，但经常被忽视：环境和工件。

- *环境（Environment）*： 环境是场景发生的一组条件。这通常是指运行时状态：系统可能处于过载状态或正常运行，或处于某种其他相关状态。对于许多系统，“正常”操作可以指多种模式之一。对于这些类型的系统，环境应指定系统在哪种模式下执行。但环境也可以指系统根本不运行的状态：当它处于开发、测试、刷新数据或两次运行之间为电池充电时。环境为场景的其余部分设置上下文。例如，在代码被冻结以进行发布后到达的修改请求的处理方式，可能与冻结之前到达的请求不同。组件的连续第五次失效的处理方式可能与该组件的第一次失效不同。

- *工件（Artifact）*：触发事件到达某个目标。这通常仅指系统或项目本身，但如果可能的话，越精确会越有帮助。工件可以是系统的集合、整个系统或系统的一个或多个部分。失效或变更请求可能只影响系统的一小部分。数据存储中的失效的处理方式可能与元数据存储中的失效不同。对用户界面的修改可能比对中间件的修改响应的更快。

总而言之，我们将质量属性要求确定为由六部分组成的场景。虽然省略这六个部分中的一个或多个是很常见的，尤其是在考虑质量属性的早期阶段，但知道所有部分都在那里会迫使架构师考虑每个部分是否相关。

我们为 [第4章][ch04] 到 [第13章][ch13] 中提出的每个质量属性创建了一个一般场景，以便进行头脑风暴和引出具体场景。我们将 *一般* 质量属性场景（一般场景）与 *具体* 质量属性场景（具体场景）区分开来，*一般* 质量属性场景与系统无关，可用于任何系统；*具体* 质量属性场景用于所考虑的特定系统。

若要将这些一般属性特征转换为特定系统的需求，需要将一般场景改为系统特定的场景。但是，正如我们所发现的，利益相关者将一般场景剪裁为适合其系统的场景比他们凭空生成场景要容易得多。

[图3.1][ch03fig01] 显示了刚才讨论的质量属性场景的各个部分。[图3.2][ch03fig02] 显示了一般场景的示例，这个例子用于可用性。

![A figure depicts the parts of a quality attribute scenario.](ch03.assets/03fig01.jpg)

<a name="ch03fig01"></a> **图3.1** 质量属性场景的各个部分

![A diagram displays the general scenario for availability.](ch03.assets/03fig02.jpg)

<a name="ch03fig02"></a> **图 3.2** 可用性的一般场景

> **不是我的问题**
>
> 前段时间，我正在对劳伦斯利弗莫尔国家实验室创建的复杂系统进行架构分析。如果你访问该组织的网站（[llnl.gov](http://llnl.gov/)）并试图弄清楚利弗莫尔实验室是做什么的，你会看到“信息安全”一词一遍又一遍地被提及。该实验室专注于核安全、国际和国内安全以及环境和能源安全。这真是个重要的工作......
>
> 牢记这一点，我要求我的客户描述我正在分析的系统所关注的质量属性。我敢肯定，当一次都没有提到信息安全性时，你可以想象我的惊讶！系统利益相关者提到了性能、可修改性、可演进性、互操作性、可配置性和可移植性，等等，但“信息安全性”这个词却从未被提及。
>
> 作为一名优秀的分析师，我质疑这个看似令人震惊和明显的遗漏。他们的回答很简单，也很直截了当：“我们不在乎它。我们的系统没有连接到任何外部网络，我们有铁丝网围栏和机枪警卫。
>
> 当然，利弗莫尔实验室的某个人对信息安全性非常感兴趣。但不是软件架构师。这里的教训是，软件架构师可能不会对每个 QA 需求承担责任。
>
> —RK

## 3.4. 通过架构模式和策略实现质量属性

我们现在转向架构师可以用来 *实现* 所需质量属性的技术：架构模式和策略。

策略是影响质量属性响应的设计决策，它直接影响系统对某些触发事件的响应。策略可能赋予一种设计可移植性，赋予另一种设计高性能，赋予第三种设计可集成性。

架构模式描述了在特定设计环境中出现的、反复出现的设计问题，并为该问题提供了经过充分验证的架构解决方案。解决方案通过描述其组成元素的角色、职责和关系以及它们的协作方式来指定。与策略的选择一样，架构模式的选择对质量属性有深远的影响——通常不止一个。

模式通常包括多个设计决策，事实上，通常包括多种质量属性策略。我们说，模式经常捆绑策略，因此，经常在质量属性之间进行权衡。

我们将在每一个质量属性特定章节中查看策略和模式之间的关系示例。[第14章][ch14] 解释了如何为任一质量属性构建一套策略；事实上，这些策略就是我们用来制作本书中你看到的各套策略的步骤。

虽然我们讨论模式和策略，就好像它们是基本的设计决策一样，但现实情况是，架构通常是许多小决策和业务力量造成的结果。例如，随着开发人员添加功能和修复错误的进行，系统中曾经可以容忍修改可能会随着时间的推移而恶化。类似地，系统的性能、可用性、信息安全性和任何其他质量可能会（并且通常会）随着时间的推移而恶化，这同样是通过程序员的善意行为，他们专注于他们的直接任务，而不是保持架构完整性。

这种“千刀万剐”在软件项目中很常见。由于缺乏对系统结构的理解、进度压力或从一开始架构就缺乏的清晰度，开发人员可能会做出次优决策。这种恶化是一种技术债务，称为架构债务。我们在 [第23章][ch23] 中讨论了架构债务。为了扭转这种债务，我们通常会进行重构。

进行重构可能有很多原因。例如，你可以重构系统以提高其信息安全性，根据其信息安全属性将不同的模块放入不同的子系统中。或者，你可以重构系统以提高其性能，消除瓶颈并重写代码的执行慢的部分。或者，你可以重构以提高系统的可修改性。例如，当两个模块因为（至少部分）彼此重复而一遍又一遍地受到相同类型更改的影响时，可以将共同功能分解到其自己的模块中，从而提高内聚并减少下一个（类似）更改请求到达时需要更改的位置数量。

代码重构是敏捷开发项目的主要实践，作为确保团队没有生成重复或过于复杂的代码的清理步骤。但是，该概念也适用于架构元素。

成功实现质量属性通常涉及与流程相关的决策，以及与架构相关的决策。例如，如果你的员工容易受到网络钓鱼攻击或不选择强密码，那么出色的信息安全架构就毫无价值。在本书中，我们不涉及流程方面，但要意识到它们很重要。

## 3.5. 使用策略进行设计

系统设计由一系列决策组成。其中一些决策有助于控制质量属性响应；其他确保实现系统功能。我们在 [图3.3][ch03fig03] 中描述了这种关系。策略，就像模式一样，是架构师多年来一直在使用的设计技术。在本书中，我们分类、编目和描述它们。我们不在此发明策略，而只是收集优秀架构师在实践中所用的。

![A figure shows the tactics to control response in a square block. A right arrow touching the left side of the block is labeled as a stimulus. A right arrow from the right end of the block is labeled as a response.](ch03.assets/03fig03.jpg)

<a name="ch03fig03"></a> **图3.3** 策略旨在控制对刺激的反应。

我们为什么要关注策略？原因有三：

1. 模式是许多架构的基础，但有时可能没有合适的模式可以完全解决你的问题。例如，你可能需要高可用性、高信息安全性的代理模式，而不是教科书式的代理模式。架构师经常需要修改和调整模式以适应其特定环境，而策略提供了一种系统的方法来增强现有模式，以填补空白。

2. 如果不存在适合实现架构师设计目标的模式，策略允许架构师根据“第一原则”构建设计片段。策略使架构师能够深入了解生成的设计片段的属性。

3. 策略提供了一种在某些范围内使设计和分析更加系统化的方法。我们将在下一节中探讨这个想法。

像任何设计概念一样，我们在这里介绍的策略可以而且应该在应用于设计系统时进行改进。以性能为例：*调度资源* 是一种常见的性能策略。但是，出于特定目的，这种策略需要细化为特定的调度策略，例如最短作业优先、轮转调度等。*使用中介* 是一种可修改策略。但是有多种类型的中介（层（layers）、中介（brokers）、代理（proxies）和层（tiers），仅举几例），它们以不同的方式实现。因此，设计师将采用改进来使每种策略具体化。

此外，策略的应用取决于具体情况。再次以性能为例：*管理采样率* 在某些实时系统中是适合的，但不是在所有实时系统中都适合，当然在数据库系统或股票交易系统中也是如此，在这些系统中，丢失单个事件是非常严重的。

请注意，有一些“超级策略”——这些策略是如此基本和普遍，以至于值得特别提及。例如，封装、限制依赖关系、使用中介和抽象公共服务的可修改性策略几乎可以在实现每个模式中找到！但其他策略，比如来自性能的调度策略，也出现在许多地方。例如，负载均衡器是调度的中介。我们看到监控出现在许多质量属性中：我们监控系统的各个方面，以实现能源效率、性能、可用性和安全性。因此，我们不应该期望一种策略只存在于一个地方，只存在于一个质量属性中。策略是设计基本要素，因此，在设计的不同方面一遍又一遍地发现。这实际上是为什么策略如此强大，值得我们和你的关注的一个论据。了解他们；他们会成为你的朋友。

## 3.6. 分析质量属性设计决策：基于策略的调查问卷

在本节中，我们将介绍一种工具：基于策略的调查问卷，分析师可以使用该工具通过架构设计了解各个阶段的潜在质量属性行为。

分析质量属性的实现情况是设计架构任务的关键部分。而且（毫不奇怪）你不应该等到你的设计完成才开始做。质量属性分析的机会出现在软件开发生命周期的许多不同的时间点，甚至是非常早期的阶段。

在任何时候，分析师（可能是架构师）都需要对可用于分析的任何工件做出适当的响应。分析的准确性和分析结果的预期置信度将根据可用工件的成熟度而有所不同。但是，无论设计状态如何，我们发现基于策略的问卷有助于深入了解架构提供所需质量属性的能力（或可能的能力，因为它是经过改进的）。

在 [第4章][ch04] 到 [第13章][ch13] 中，我们为章节中涵盖的每个质量属性包括了一个基于策略的调查问卷。对于调查问卷中的每个问题，分析师记录以下信息：

- 系统架构是否支持每种策略。

- 使用（或不使用）这种策略是否有任何明显的风险。如果使用了该策略，请记录如何在系统中实现它，或者打算如何实现它（例如，通过自定义代码、通用框架或外部开发的组件）。

- 为实现该策略而做出的具体设计决策，以及在代码库中的何处可以找到实现（implementation）（实现（realization））。这对于审核和架构重建目的非常有用。

- 在实现此策略时所做的任何理由或假设。

要使用这些问卷，只需遵循以下四个步骤：

1. 对于每个策略问题，如果架构支持策略，请用“Y”填充“支持”列，否则用“N”填充。

2. 如果“支持”列中的答案是“Y”，则在“设计决策和位置”列中描述为支持策略而做出的具体设计决策，并列举这些决策在架构中显示（定位）的位置。例如，指示哪些代码模块、框架或包实现了此策略。

3. 在“风险”列中，使用（H=高，M=中，L=低）指出实施策略的风险。

4. 在“理由”列中，描述所做设计决策的理由（包括 *不* 使用此策略的决定）。简要说明此决定的含义。例如，从成本、进度、演进等方面来解释决策的理由和影响。

虽然这种基于问卷的方法听起来很简单，但实际上它可以非常强大和有见地。解决这一系列问题迫使架构师退后一步，考虑更大的图景。此过程也可以非常有效：单个质量属性的典型调查表需要 30 到 90 分钟完成。

## 3.7. 小结

通过在设计中包含一组适当的职责来满足*功能性* 需求。*质量属性* 需求由架构的结构和行为满足。

架构设计中的一个挑战是，这些需求往往没有被很好地抓住，如果有的话。若要抓住和表达质量属性需求，我们建议使用质量属性场景。每个方案由六个部分组成：

1. 触发来源
2. 触发事件
3. 环境
4. 工件
5. 响应
6. 响应测量

架构策略是影响质量属性响应的设计决策。策略的重点是单个质量属性响应。架构模式描述了在特定设计环境中出现的、特定的重复出现的设计问题，并为该问题提供了经过充分验证的架构解决方案。架构模式可以看作是一组策略的“捆绑”。

分析师可以通过使用基于策略的清单来了解架构中做出的决策。这种轻量级架构分析技术可以在很短的时间内深入了解架构的优势和劣势。

## 3.8. 扩展阅读

一些扩展的案例研究显示了如何在设计中使用策略和模式，可以在[[Cervantes 16][ref_54]]中找到。

大量的架构模式目录可以在Frank Buschmann等人的五卷集《面向模式的软件架构》中找到。

表明许多不同的架构可以提供相同功能的论点 - 也就是说，架构和功能在很大程度上是正交的 - 可以在[[Shaw 95][ref_230]]中找到。

## 3.9. 问题讨论

**1.** 用例和质量属性场景之间的关系是什么？如果你想向用例添加高质量的属性信息，你将如何去做？

**2.** 你认为质量属性的策略的集合是有限的还是无限的？为什么？

**3.** 枚举自动柜员机应支持的职责集，并提出适应该职责集的设计。证明你的建议是合理的。

**4.** 选择你熟悉的架构（或选择你在问题 3 中定义的 ATM 架构）并浏览性能策略问卷（可在 [第9章][ch09] 中找到）。这些问题为做出（或未做出）的设计决策提供了哪些见解？

------

[ch03_sec03]: ch03.md#ch03_sec03
[ch03fig01]: ch03.md#ch03fig01
[ch03fig02]: ch03.md#ch03fig02
[ch03fig03]: ch03.md#ch03fig03

[part02]: part02.md

[ch02]: ch02.md
[ch04]: ch04.md
[ch09]: ch09.md
[ch13]: ch13.md
[ch14]: ch14.md
[ch20]: ch20.md
[ch21]: ch21.md
[ch23]: ch23.md

[ref_54]: ref01.md#ref_54
[ref_230]: ref01.md#ref_230
